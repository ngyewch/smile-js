import t, {Test} from 'tap';
import {arrayEqual, throws} from './utils/assert.js';
import {BigInteger} from '../src/bigInteger.js';

t.test('should decode/encode BigInteger values', t => {
    doTest(t, BigInt('1329227995784915872903807060280344576'), new Uint8Array([0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00]));
    doTest(t, BigInt('-1329227995784915872903807060280344576'), new Uint8Array([0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00]));
    doTest(t, BigInt('18446744073709551615'), new Uint8Array([0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff]));
    doTest(t, BigInt('-18446744073709551615'), new Uint8Array([0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01]));

    t.end();
});

function doTest(t: Test, value: bigint, bytes: Uint8Array) {
    t.equal(BigInteger.decode(bytes), value);
    arrayEqual(t, BigInteger.encode(value), bytes);
}
